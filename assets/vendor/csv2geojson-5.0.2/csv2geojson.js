!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).csv2geojson=e()}}(function(){return function e(r,t,n){function o(a,u){if(!t[a]){if(!r[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var f=t[a]={exports:{}};r[a][0].call(f.exports,function(e){var t=r[a][1][e];return o(t||e)},f,f.exports,e,r,t,n)}return t[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,r,t){"use strict";function n(e,r){var t,n,o;for(var i in e)(n=i.match(r))&&(!t||n[0].length/i.length>o)&&(o=n[0].length/i.length,t=i);return t}function o(e){return n(e,c)}function i(e){return n(e,p)}function a(e){return"object"==typeof e?Object.keys(e).length:0}function u(e){var r=[];return[",",";","\t","|"].forEach(function(t){var n=l.dsvFormat(t).parse(e);if(n.length>=1){for(var o=a(n[0]),i=0;i<n.length;i++)if(a(n[i])!==o)return;r.push({delimiter:t,arity:Object.keys(n[0]).length})}}),r.length?r.sort(function(e,r){return r.arity-e.arity})[0].delimiter:null}function s(e){return delete e.columns,e}var l=e("d3-dsv"),f=e("sexagesimal"),c=/(Lat)(itude)?/gi,p=/(L)(on|ng)(gitude)?/i;r.exports={isLon:function(e){return!!e.match(p)},isLat:function(e){return!!e.match(c)},guessLatHeader:o,guessLonHeader:i,csv:l.csvParse,tsv:l.tsvParse,dsv:l,auto:function(e){var r=u(e);return r?s(l.dsvFormat(r).parse(e)):null},csv2geojson:function(e,r,t){t||(t=r,r={}),r.delimiter=r.delimiter||",";var n=r.latfield||"",a=r.lonfield||"",s=r.crs||"",c=[],p={type:"FeatureCollection",features:c};if(""!==s&&(p.crs={type:"name",properties:{name:s}}),"auto"!==r.delimiter||"string"!=typeof e||(r.delimiter=u(e),r.delimiter)){var d="string"==typeof e?l.dsvFormat(r.delimiter).parse(e):e;if(d.length){var v,m=[];if(n||(n=o(d[0])),a||(a=i(d[0])),n&&a){for(v=0;v<d.length;v++)if(void 0!==d[v][a]&&void 0!==d[v][n]){var g,h,y,w=d[v][a],F=d[v][n];(y=f(w,"EW"))&&(w=y),(y=f(F,"NS"))&&(F=y),g=parseFloat(w),h=parseFloat(F),isNaN(g)||isNaN(h)?m.push({message:"A row contained an invalid value for latitude or longitude",row:d[v],index:v}):(r.includeLatLon||(delete d[v][a],delete d[v][n]),c.push({type:"Feature",properties:d[v],geometry:{type:"Point",coordinates:[parseFloat(g),parseFloat(h)]}}))}t(m.length?m:null,p)}else{for(v=0;v<d.length;v++)c.push({type:"Feature",properties:d[v],geometry:null});t(m.length?m:null,p)}}else t(null,p)}else t({type:"Error",message:"Could not autodetect delimiter"})},toLine:function(e){for(var r=e.features,t={type:"Feature",geometry:{type:"LineString",coordinates:[]}},n=0;n<r.length;n++)t.geometry.coordinates.push(r[n].geometry.coordinates);return t.properties=r.reduce(function(e,r){for(var t in r.properties)e[t]||(e[t]=[]),e[t].push(r.properties[t]);return e},{}),{type:"FeatureCollection",features:[t]}},toPolygon:function(e){for(var r=e.features,t={type:"Feature",geometry:{type:"Polygon",coordinates:[[]]}},n=0;n<r.length;n++)t.geometry.coordinates[0].push(r[n].geometry.coordinates);return t.properties=r.reduce(function(e,r){for(var t in r.properties)e[t]||(e[t]=[]),e[t].push(r.properties[t]);return e},{}),{type:"FeatureCollection",features:[t]}}}},{"d3-dsv":2,sexagesimal:3}],2:[function(e,r,t){!function(e,n){n("object"==typeof t&&void 0!==r?t:e.d3=e.d3||{})}(this,function(e){"use strict";function r(e){return new Function("d","return {"+e.map(function(e,r){return JSON.stringify(e)+": d["+r+"]"}).join(",")+"}")}function t(e,t){var n=r(e);return function(r,o){return t(n(r),o,e)}}function n(e){var r=Object.create(null),t=[];return e.forEach(function(e){for(var n in e)n in r||t.push(r[n]=n)}),t}function o(e){function o(e,r){function t(){if(f>=l)return a;if(o)return o=!1,i;var r,t=f;if(34===e.charCodeAt(t)){for(var n=t;n++<l;)if(34===e.charCodeAt(n)){if(34!==e.charCodeAt(n+1))break;++n}return f=n+2,r=e.charCodeAt(n+1),13===r?(o=!0,10===e.charCodeAt(n+2)&&++f):10===r&&(o=!0),e.slice(t+1,n).replace(/""/g,'"')}for(;f<l;){var u=1;if(10===(r=e.charCodeAt(f++)))o=!0;else if(13===r)o=!0,10===e.charCodeAt(f)&&(++f,++u);else if(r!==s)continue;return e.slice(t,f-u)}return e.slice(t)}for(var n,o,i={},a={},u=[],l=e.length,f=0,c=0;(n=t())!==a;){for(var p=[];n!==i&&n!==a;)p.push(n),n=t();r&&null==(p=r(p,c++))||u.push(p)}return u}function i(r){return r.map(a).join(e)}function a(e){return null==e?"":u.test(e+="")?'"'+e.replace(/\"/g,'""')+'"':e}var u=new RegExp('["'+e+"\n]"),s=e.charCodeAt(0);return{parse:function(e,n){var i,a,u=o(e,function(e,o){if(i)return i(e,o-1);a=e,i=n?t(e,n):r(e)});return u.columns=a,u},parseRows:o,format:function(r,t){return null==t&&(t=n(r)),[t.map(a).join(e)].concat(r.map(function(r){return t.map(function(e){return a(r[e])}).join(e)})).join("\n")},formatRows:function(e){return e.map(i).join("\n")}}}var i=o(","),a=i.parse,u=i.parseRows,s=i.format,l=i.formatRows,f=o("\t"),c=f.parse,p=f.parseRows,d=f.format,v=f.formatRows;e.dsvFormat=o,e.csvParse=a,e.csvParseRows=u,e.csvFormat=s,e.csvFormatRows=l,e.tsvParse=c,e.tsvParseRows=p,e.tsvFormat=d,e.tsvFormatRows=v,Object.defineProperty(e,"__esModule",{value:!0})})},{}],3:[function(e,r,t){function n(e,r){var t=o(e,r);return t.whole+"° "+(t.minutes?t.minutes+"' ":"")+(t.seconds?t.seconds+'" ':"")+t.dir}function o(e,r){var t=({lat:["N","S"],lon:["E","W"]}[r]||"")[e>=0?0:1],n=Math.abs(e),o=Math.floor(n),i=60*(n-o),a=Math.floor(i);return{whole:o,minutes:a,seconds:Math.floor(60*(i-a)),dir:t}}function i(e,r,t){if(r||(r="NSEW"),"string"!=typeof e)return{val:null,regex:t};var n=(t=t||/[\s\,]*([\-|\—|\―]?[0-9.]+)°? *(?:([0-9.]+)['’′‘] *)?(?:([0-9.]+)(?:''|"|”|″) *)?([NSEW])?/gi).exec(e);return n?n[4]&&-1===r.indexOf(n[4])?{val:null,regex:t}:{val:((n[1]?parseFloat(n[1]):0)+(n[2]?parseFloat(n[2])/60:0)+(n[3]?parseFloat(n[3])/3600:0))*(n[4]&&"S"===n[4]||"W"===n[4]?-1:1),regex:t,raw:n[0],dim:n[4]}:{val:null,regex:t}}function a(e,r,t){return"N"===t||"S"===t?[e,r]:"W"===t||"E"===t?[r,e]:void 0}r.exports=function(e,r){return i(e,r).val},r.exports.pair=function(e,r){var t=i(e=e.trim(),r);if(null===t.val)return null;var n=i(e,r,t.regex);return null===n.val?null:t.raw+n.raw!==e?null:t.dim?a(t.val,n.val,t.dim):[t.val,n.val]},r.exports.format=n,r.exports.formatPair=function(e){return n(e.lat,"lat")+" "+n(e.lon,"lon")},r.exports.coordToDMS=o},{}]},{},[1])(1)});
