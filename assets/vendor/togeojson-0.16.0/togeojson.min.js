var toGeoJSON=function(){"use strict";function e(e){if(!e||!e.length)return 0;for(var t=0,r=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t)|0;return r}function t(e,t){return e.getElementsByTagName(t)}function r(e,t){return e.getAttribute(t)}function n(e,t){return parseFloat(r(e,t))}function i(e,r){var n=t(e,r);return n.length?n[0]:null}function o(e){return e.normalize&&e.normalize(),e}function a(e){for(var t=0,r=[];t<e.length;t++)r[t]=parseFloat(e[t]);return r}function s(e){return e&&o(e),e&&e.textContent||""}function l(e,t){var r,n,o={};for(n=0;n<t.length;n++)(r=i(e,t[n]))&&(o[t[n]]=s(r));return o}function u(e,t){for(var r in t)e[r]=t[r]}function f(e){return a(e.replace(m,"").split(","))}function c(e){for(var t=e.replace(y,"").split(d),r=[],n=0;n<t.length;n++)r.push(f(t[n]));return r}function g(e){var t,r=[n(e,"lon"),n(e,"lat")],o=i(e,"ele"),a=i(e,"gpxtpx:hr")||i(e,"hr"),l=i(e,"time");return o&&(t=parseFloat(s(o)),isNaN(t)||r.push(t)),{coordinates:r,time:l?s(l):null,heartRate:a?parseFloat(s(a)):null}}function p(e){return void 0!==e.xml?e.xml:h.serializeToString(e)}var h,m=/\s*/g,y=/^\s*|\s*$/g,d=/\s+/;return"undefined"!=typeof XMLSerializer?h=new XMLSerializer:"object"!=typeof exports||"object"!=typeof process||process.browser||(h=new(require("xmldom").XMLSerializer)),{kml:function(n){function o(e){var t,r;return"#"===(e=e||"").substr(0,1)&&(e=e.substr(1)),6!==e.length&&3!==e.length||(t=e),8===e.length&&(r=parseInt(e.substr(0,2),16)/255,t="#"+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)),[t,isNaN(r)?void 0:r]}function l(e){return a(e.split(" "))}function u(e){var r=t(e,"coord","gx"),n=[],i=[];0===r.length&&(r=t(e,"gx:coord"));for(var o=0;o<r.length;o++)n.push(l(s(r[o])));for(var a=t(e,"when"),u=0;u<a.length;u++)i.push(s(a[u]));return{coords:n,times:i}}function g(e){var r,n,o,a,l,p=[],h=[];if(i(e,"MultiGeometry"))return g(i(e,"MultiGeometry"));if(i(e,"MultiTrack"))return g(i(e,"MultiTrack"));if(i(e,"gx:MultiTrack"))return g(i(e,"gx:MultiTrack"));for(o=0;o<v.length;o++)if(n=t(e,v[o]))for(a=0;a<n.length;a++)if(r=n[a],"Point"===v[o])p.push({type:"Point",coordinates:f(s(i(r,"coordinates")))});else if("LineString"===v[o])p.push({type:"LineString",coordinates:c(s(i(r,"coordinates")))});else if("Polygon"===v[o]){var m=t(r,"LinearRing"),y=[];for(l=0;l<m.length;l++)y.push(c(s(i(m[l],"coordinates"))));p.push({type:"Polygon",coordinates:y})}else if("Track"===v[o]||"gx:Track"===v[o]){var d=u(r);p.push({type:"LineString",coordinates:d.coords}),d.times.length&&h.push(d.times)}return{geoms:p,coordTimes:h}}for(var h={type:"FeatureCollection",features:[]},m={},y={},d={},v=["Polygon","LineString","Point","Track","gx:Track"],S=t(n,"Placemark"),k=t(n,"Style"),T=t(n,"StyleMap"),x=0;x<k.length;x++){var b=e(p(k[x])).toString(16);m["#"+r(k[x],"id")]=b,y[b]=k[x]}for(var L=0;L<T.length;L++){m["#"+r(T[L],"id")]=e(p(T[L])).toString(16);for(var N=t(T[L],"Pair"),M={},F=0;F<N.length;F++)M[s(i(N[F],"key"))]=s(i(N[F],"styleUrl"));d["#"+r(T[L],"id")]=M}for(var P=0;P<S.length;P++)h.features=h.features.concat(function(e){var n,a=g(e),l={},u=s(i(e,"name")),f=s(i(e,"styleUrl")),c=s(i(e,"description")),p=i(e,"TimeSpan"),h=i(e,"TimeStamp"),v=i(e,"ExtendedData"),S=i(e,"LineStyle"),k=i(e,"PolyStyle"),T=i(e,"visibility");if(!a.geoms.length)return[];if(u&&(l.name=u),f){"#"!==f[0]&&(f="#"+f),l.styleUrl=f,m[f]&&(l.styleHash=m[f]),d[f]&&(l.styleMapHash=d[f],l.styleHash=m[d[f].normal]);var x=y[l.styleHash];x&&(S||(S=i(x,"LineStyle")),k||(k=i(x,"PolyStyle")))}if(c&&(l.description=c),p){var b=s(i(p,"begin")),L=s(i(p,"end"));l.timespan={begin:b,end:L}}if(h&&(l.timestamp=s(i(h,"when"))),S){var N=o(s(i(S,"color"))),M=N[0],F=N[1],P=parseFloat(s(i(S,"width")));M&&(l.stroke=M),isNaN(F)||(l["stroke-opacity"]=F),isNaN(P)||(l["stroke-width"]=P)}if(k){var w=o(s(i(k,"color"))),R=w[0],z=w[1],C=s(i(k,"fill")),G=s(i(k,"outline"));R&&(l.fill=R),isNaN(z)||(l["fill-opacity"]=z),C&&(l["fill-opacity"]="1"===C?l["fill-opacity"]||1:0),G&&(l["stroke-opacity"]="1"===G?l["stroke-opacity"]||1:0)}if(v){var A=t(v,"Data"),H=t(v,"SimpleData");for(n=0;n<A.length;n++)l[A[n].getAttribute("name")]=s(i(A[n],"value"));for(n=0;n<H.length;n++)l[H[n].getAttribute("name")]=s(H[n])}T&&(l.visibility=s(T)),a.coordTimes.length&&(l.coordTimes=1===a.coordTimes.length?a.coordTimes[0]:a.coordTimes);var D={type:"Feature",geometry:1===a.geoms.length?a.geoms[0]:{type:"GeometryCollection",geometries:a.geoms},properties:l};return r(e,"id")&&(D.id=r(e,"id")),[D]}(S[P]));return h},gpx:function(e){function n(e,r){var n=t(e,r),i=[],o=[],a=[],s=n.length;if(s<2)return{};for(var l=0;l<s;l++){var u=g(n[l]);i.push(u.coordinates),u.time&&o.push(u.time),u.heartRate&&a.push(u.heartRate)}return{line:i,times:o,heartRates:a}}function i(e){var n,i;n=l(e,["name","cmt","desc","time","keywords"]),(i=t(e,"link")).length&&(n.links=[]);for(var o,a=0;a<i.length;a++)u(o={href:r(i[a],"href")},l(i[a],["text","type"])),n.links.push(o);return n}var o,a,s=t(e,"trk"),f=t(e,"rte"),c=t(e,"wpt"),p={type:"FeatureCollection",features:[]};for(o=0;o<s.length;o++)(a=function(e){for(var r,o=t(e,"trkseg"),a=[],s=[],l=[],u=0;u<o.length;u++)(r=n(o[u],"trkpt"))&&(r.line&&a.push(r.line),r.times&&r.times.length&&s.push(r.times),r.heartRates&&r.heartRates.length&&l.push(r.heartRates));if(0!==a.length){var f=i(e);return s.length&&(f.coordTimes=1===a.length?s[0]:s),l.length&&(f.heartRates=1===a.length?l[0]:l),{type:"Feature",properties:f,geometry:{type:1===a.length?"LineString":"MultiLineString",coordinates:1===a.length?a[0]:a}}}}(s[o]))&&p.features.push(a);for(o=0;o<f.length;o++)(a=function(e){var t=n(e,"rtept");if(t.line)return{type:"Feature",properties:i(e),geometry:{type:"LineString",coordinates:t.line}}}(f[o]))&&p.features.push(a);for(o=0;o<c.length;o++)p.features.push(function(e){var t=i(e);return u(t,l(e,["sym","type"])),{type:"Feature",properties:t,geometry:{type:"Point",coordinates:g(e).coordinates}}}(c[o]));return p}}}();"undefined"!=typeof module&&(module.exports=toGeoJSON);